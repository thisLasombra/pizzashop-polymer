<link rel="import" href="/bower_components/polymer/polymer-element.html">

<dom-module id="ps-pizza-details">
    <template>
        <h2>pizza details [[pizzaId]]</h2>
        <div>[[pizza.name]]</div>
    </template>

    <script>
        class PsPizzaDetails extends Polymer.Element {
            static get is() {return 'ps-pizza-details';}
            static get properties() {
                return {
                    pizzaId: {
                        type: String,
                        observer: '_pizzaIdChanged'
                    },
                    active: Boolean
                }
            }
            _pizzaIdChanged(id) {
                /**
                 * If using iron-pages for routing, you will see how after
                 * navigating to and outside a page it does not get disconnected
                 * from the DOM, therefore all observers and event listeners will
                 * still be active, we have to check that this page is active or
                 * if a valid id is found (`pizzas/add`) we will be redirected
                 * to /pizzas.
                 */
                if (!this.active) {
                    return;
                }
                const pizza = this._findPizzaById(id);
                /**
                 * We can not automatically redirect to 404
                 * from the router, since this component matches
                 * /:id we must check if there is a pizza and
                 * handle that case manually. 
                 */
                if (!pizza) {
                    this._goToList();
                }
                this.pizza = pizza;
            }
            _findPizzaById(id) {
                // Use double equals since matching String against Number
                return (this.pizzas && id && this.pizzas.find((pizza) => pizza.id == id));
            }
            _goToList() {
                Router.setRoute('/pizzas');
            }
        }
        customElements.define(PsPizzaDetails.is, PsPizzaDetails);
    </script>
</dom-module>