<link rel="import" href="/bower_components/polymer/polymer-element.html">
<link rel="import" href="/bower_components/iron-pages/iron-pages.html">
<link rel="import" href="/bower_components/iron-selector/iron-selector.html">
<link rel="import" href="../core/routing/director.html">
<link rel="import" href="./list/ps-pizza-list.html">


<dom-module id="ps-pizza-routing">
    <template>

        <style>
            iron-pages {
                height: 100%;
            }
        </style>
        <!-- 
            TODO: setup iron pages to achieve the following configuration:
            ps-pizza-list /pizzas
            ps-pizza-add /pizzas/add
            ps-pizza-details /pizzas/details
            ps-not-found fallback
         -->

    </template>
    <script>   

        class PsPizzaRouting extends Polymer.Element {
            static get is() {return 'ps-pizza-routing';}
            static get properties() {
                return {
                    page: {
                        type: String,
                        observer: '_pageChanged'
                    },
                    routes: {
                        type: Object,
                        value: {
                            add: 'add/ps-pizza-add.html',
                            details: 'details/ps-pizza-details.html',
                            list: 'list/ps-pizza-list.html',
                            fallback: '../core/pages/ps-not-found.html'
                        },
                        readOnly: true,
                    },
                    defaultPage: {
                        type: String,
                        value: 'list',
                        readOnly: true,
                    },
                    id: String,
                };
            }
            ready() {
                super.ready();
                this._setupRoutes();
            }
            _isActive(page) {
                return page === this.page;
            }
            _setupRoutes() {
                // TODO: confiture a new director router to
                // manage the pizzas module
            }
            _pageChanged() {
                if (this.page === this.defaultPage) {
                    return;
                }
                const componentPath = this._resolveComponent(this.page);
                Polymer.importHref(
                    this.resolveUrl(componentPath),
                    null, null, true
                );
            }
            _resolveComponent(page) {
                if (!this.routes[page]) {
                    return this.routes.fallback;
                }
                return this.routes[page];
            }
        }
        customElements.define(PsPizzaRouting.is, PsPizzaRouting);

    </script>
</dom-module>